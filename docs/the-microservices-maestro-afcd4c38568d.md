# 微服务大师

> 原文：<https://medium.datadriveninvestor.com/the-microservices-maestro-afcd4c38568d?source=collection_archive---------8----------------------->

我喜欢住在城市的一个原因是它是为大众服务的。尽管有许多缺点(雨不是其中之一)，西雅图的设计是为了让成千上万的人能够度过他们忙碌的日子。它有一个连接不同区域的交通系统，它对公园、住宅、商业和学校规定了不同的土地使用政策，并提供了限制停车区。它是为步行而设计的(假设你喜欢山)，它提供了去医院的便捷通道，并且由警察和消防部门守卫。

但西雅图最初并不是一个大城市，它的发展更多的是一种正在进行的工作。像包括全能的纽约在内的许多其他城市一样，西雅图也在不断发展和重新规划，这样它就可以*扩展*来支持更多的人。它需要更高效的交通(想想地铁)，更大的高速公路，更多的停车场，更多的娱乐区和住宅区。

[](https://www.datadriveninvestor.com/2019/01/23/which-is-more-promising-data-science-or-software-engineering/) [## 数据科学和软件工程哪个更有前途？数据驱动的投资者

### 大约一个月前，当我坐在咖啡馆里为一个客户开发网站时，我发现了这个女人…

www.datadriveninvestor.com](https://www.datadriveninvestor.com/2019/01/23/which-is-more-promising-data-science-or-software-engineering/) 

城市规划和软件工程之间的相似之处令我着迷，Sam Newman 在他的“构建微服务”[一书中有很好的描述。就像城市从小镇开始一样，大多数服务都是从位于某人办公桌下的简单服务器开始的，每天处理几百个请求。给一些时间，如果想法是正确的，一项服务可能会变得流行——这是一件很好的事情，除了增加需求的挑战很快变成了处理更高的客户期望的问题。这类似于当一个城镇发展成一个城市时，我们如何期待更好的交通和更有效的警察执法。](http://shop.oreilly.com/product/0636920033158.do)

我个人很喜欢 Twitter 的失败鲸的故事。就像姚悦[提到](https://www.youtube.com/watch?v=6OvrFkLSoZ0)一样，鲸是一个*成长*的故事。Twitter 从一个名为 *Monorail* 的整体服务开始，它代表了一个具有巨大范围的巨大功能盒子。虽然这可能是最好的开始方式，但是单轨铁路很快变得太复杂而难以推理。随着 Twitter 的工程团队不断增加新功能，可用性和缓慢的性能问题浮出水面。这需要更多的资源和更有原则的架构，以及更好的故障处理。Twitter 用一条失败的鲸鱼的图片很好地掩盖了它的系统错误。

![](img/0bd746dad9e5c1ef3e2e27fbbf8308aa.png)

如果这些听起来很熟悉，也许你应该考虑效仿 Twitter 的方法，采用基于微服务的架构。

将一个整体架构发展成一组微服务就是将一个“我可以做任何事情”的大盒子分割成更易于管理的、有职责范围的盒子。这也是将团队分成更小的团队，专注于这些服务的子集([康威定律](https://en.wikipedia.org/wiki/Conway%27s_law))。产生的服务是自治的——就像管理它们的团队一样——因此它们可以独立部署。

获得正确的微服务架构是一个相当大的工程旅程，它需要纪律和耐心。微服务大师(即*你*)必须能够协调关注点分离、系统整体凝聚力、故障降级、安全性和隐私的原则。

我发现建立一些初始的关键架构原则并确保它们被实现可以帮助减轻这些挑战。

*从工程和运营准备角度来看:*

1.  **终极测试环境**。在生产中有许多测试策略。我最喜欢的一个是金丝雀测试，这是一种常见的实践，在大范围推广之前，不太稳定的代码只在一小部分生产流量中启用，并“烘烤”一段预定的时间。
2.  **持续部署**。理想情况下，从入住到生产的时间是几个小时，而不是几个月。要实现这一点，通常需要构建一个完全自动化的部署管道，能够安全可靠地取得进展。
3.  **看着学**。任何不包括对其性能、资源利用或意外故障情况的基本监控的功能都不能被认真对待——发布它就像盲目飞行，希望它能正常工作。在一个扩展到每分钟数百万个请求的系统中，那些被认为只有 0.01%的失败几率的东西将会每分钟失败一次，并且几乎需要立即补救。希望不是软件工程中的一个策略，但是监控服务和从他们的数据中学习才是。
4.  **渐进式改进**。我通常避免等待完美的系统被执行。最好是发布一些小的东西，并随着时间的推移进行改进。

*从内部架构的角度来看:*

1.  **自主的力量。**这听起来可能很重要，但是与业务逻辑紧密耦合的共享代码是一种*反模式*，应该避免，以利于自治和系统分散化。
2.  **拥抱合同变更**。期望两个服务之间的契约不会改变是不现实的。版本支持、向后兼容性和可升级性对于任何功能的长期稳定性都是必不可少的。
3.  **去异步**。花费资源等待响应的服务可能是一种浪费。在异步世界中，通信遵循基于事件的模型，发布/订阅服务不会等待。然而，没有免费的午餐，基于事件的系统的诊断已被证明是一个具有挑战性的领域。
4.  **不要储存可以重新学习的东西。无状态服务很容易推理。在许多情况下，如果它们的最新版本被证明是不稳定的，它们可以以最小的风险回滚。另一方面，回滚有状态服务可能会导致多种难以理解的副作用，并增加数据损坏的可能性。此外，持久数据通常需要一致性模型、高可用性和快速检索。**
5.  **有弹性**。我非常喜欢网飞的混沌猴(Chaos Monkey)的想法——一种不断触发网飞服务中受控故障的服务，以确保所有服务都有可靠的故障隔离保证。迈克尔·尼加德的书*发布吧！*推荐断路器作为值得探索的防止故障传播的保护机制。简而言之，断路器就是切断与不可用服务的进一步通信，以避免填满请求队列。一旦外部服务恢复在线，就可以自动恢复通信。

总的来说，我认为缩放是困难的，并且经常被低估；我预计这是一个在未来几年将会有巨大创新的领域。

你喜欢这篇文章吗？ [**订阅**](https://geekonrecord.com/subscribe/) **通过邮件获取新帖。**

*原载于 2019 年 9 月 14 日 geekonrecord.com**T21*[。](https://geekonrecord.com/2019/09/14/the-microservices-maestro/)

*图片来源:* [*史蒂夫·丹尼斯*](http://www.subcide.com/experiments/fail-whale/)