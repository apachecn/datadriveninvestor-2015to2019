# Keras:大型数据集培训

> 原文：<https://medium.datadriveninvestor.com/keras-training-on-large-datasets-3e9d9dbc09d4?source=collection_archive---------0----------------------->

![](img/5bc9ada80757bb6e0da4875becc16bf4.png)

我已经开始写这些短文，作为对自己的一系列“自我提醒”。我分享它们，希望其他人也能发现它们的用处]

如果你曾经试图用大量的数据(例如图像)训练一个网络，而这些数据不适合存储在内存中，你一定发现你需要使用某种类型的数据生成器来批量创建数据，并将其输入到你的网络中进行训练。

TensorFlow 有自己的生成器，但是 API 不必要的复杂，很容易出错。我是 Keras 的忠实粉丝，因为它消除了学习繁琐的 API 的开销(无论如何，这可能会在接下来的几个月内改变)，并使专注于您的设计成为可能。

使用 Keras 中的`Sequence`类作为批处理生成器的另一个好处是，Keras 处理所有的多线程和并行化，以确保(尽可能)你的训练(backprop)不必等待批处理生成。它通过使用多个 CPU 内核提前获取批处理来实现这一点。

# 使用 Keras 中的序列类

Keras [文档](https://keras.io/utils/#sequence)有一个完美的例子(我只是重构了一些变量名，让它更清楚):

让我们看一下这个例子，看看它做了什么:

**第 5 行**:我们的 generator 类继承自 Sequence 类。

**第 7 行**:我们可以在这里给我们的生成器输入参数。在这个例子中，我们将图像文件名作为`self.image_filenames` 传递，将它们对应的标签作为`self.labels`传递，将批处理大小作为`self.batch_size`

**第 11 行**:该函数计算该生成器应该生产的批次数量。因此，我们用总样本数除以 batch_size 并返回该值。

**第 14 行**:在这里，给定批号`idx`你需要把一个由数据批次和基本事实(GT)组成的列表放在一起。在这个例子中，我们读取一批大小为`self.batch`的图像，并返回一个形式为`[image_batch, GT]`的数组。

好了，我们已经创建了数据生成器。下一步是创建这个类的实例，并将它们提供给`fit_generator`:

**第 1，2 行**:实例化 My_Generator 的两个实例(一个用于训练，一个用于验证)，并用训练和验证的图像文件名以及训练和验证集的真实情况初始化它们。

**第 4 行**:将上面创建的`My_Generator`类的两个实例馈给`fit_generator`。就是这样；我们完了！

如果您有多个 CPU 内核，将`use_multiprocessing`设置为`True`，以便生成器可以在 CPU 上并行运行。将`workers`设置为您想要分配给批量生成的 CPU 内核数。

就是这样。希望这对你有用。