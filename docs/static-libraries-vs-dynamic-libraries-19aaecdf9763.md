# 静态库与动态库

> 原文：<https://medium.datadriveninvestor.com/static-libraries-vs-dynamic-libraries-19aaecdf9763?source=collection_archive---------8----------------------->

![](img/fed9614c704829b4247859fe014e5c5c.png)

首先，如果你正在寻找一个针对初学者的帖子，这可能不适合你。我将使用一些可能需要进一步阅读才能理解上下文的技术词汇。

C 编程中的库是一组函数，当被其他程序调用时，这些函数就可以使用了。这两种类型的库是静态和动态的。继续阅读，我会告诉你每个图书馆的所有信息，如何以及何时使用它们，以及每个图书馆的优缺点。

# 静态库

静态库中包含的函数是在编译时提供的。在编译程序时，在链接阶段，链接器将产生一个可执行文件，该文件将包括正在使用的库中所有函数的目标代码。当你不需要处理很多函数的时候，你应该只需要使用静态库。这背后的原因是所有的函数都包含在可执行文件中，这使得文件更大。但是，值得注意的是，当一个函数被多次引用时，将所有函数都包含在可执行文件中会提高运行速度。

使用静态库的一个缺点是代码已经在可执行文件中了，如果要修改函数的代码，必须重新编译。我不认为这有什么大不了的，但是作为程序员，如果有机会，你有时会想走最简单的路线。

## 创建和使用静态库(仅限 Linux)

要创建库，您需要使用带有标志`rc`的 archive 命令。此外，您应该为以`lib`开头的库包含您想要的名称，并包含应该在库中的任何目标文件:

`ar rc libfun.a hello.o`

# 动态图书馆

这个库实际上存在于可执行文件之外，而不是包含函数。对于这个特定的库，这些函数在运行时是可用的。当处理大量函数时，这个库将是必经之路。在编译期间，动态链接器将获取文件的目标代码，然后获取内存中该函数可用的地址。因为函数只有在被程序调用时才会被包含，这使得文件变得更小。

使用动态库的一个问题是程序更容易崩溃，因为库可能会损坏，从而无法工作。

## 创建和使用动态库

要创建这个库，首先用 gcc 和标志`-c`和`-fPIC`编译您的`.c`文件。`c`标志是从`.c`文件中创建目标文件，`fPIC`标志是生成目标代码:

`gcc -c -fPIC hello.c`

接下来，您想要使用`gcc`创建您的动态库。你应该使用`-share`标志来指定动态库。你的库名应该以`lib`开头，以`.so`结尾。在本例中，我将创建一个名为“fun”的库:

`gcc -share -o libfun.so hello.o`

最后一步是添加一个库环境变量，这样程序就可以知道在哪里查找:

`export LD_LIBRARY_PATH=$PWD:$LD_LIBRARY_PATH`

# 使用图书馆

当你想使用某个库的时候，你需要用 gcc 来编译它。使用`-L.`标志表明该库在当前库中(注意`.`)。使用`-l`标志和库名，省略`lib`和`.so`:

`gcc -L. -lfun -o test`

我希望阅读这篇文章能帮助你更好地理解 C 库，并且能够按照步骤创建自己的库。感谢阅读，并期待我更多的技术职位。