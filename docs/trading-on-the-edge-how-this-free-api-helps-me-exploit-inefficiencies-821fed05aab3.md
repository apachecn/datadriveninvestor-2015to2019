# 边缘交易:这个免费 API 如何帮助我利用低效率

> 原文：<https://medium.datadriveninvestor.com/trading-on-the-edge-how-this-free-api-helps-me-exploit-inefficiencies-821fed05aab3?source=collection_archive---------2----------------------->

![](img/2adedf8392d0be9503cb7b98368d5e32.png)

当公司报告他们的季度收益时，他们被要求在他们的收益表中包括“不寻常”的项目，这些项目通常不会在正常的业务运作中发生。这些费用通常包括并购费用或一次性资产减记，从净收入中扣除。

这些调整会导致投资者对坏消息反应过度——这是有效市场纯粹主义者不相信的。然而，在“核心收益:新数据和证据”中，哈佛商学院的伊桑·鲁恩和王嘉廉以及麻省理工学院的埃里克·索证明，这些短期调整实际上扭曲了价格，使其高于或低于应有水平。

[](https://www.datadriveninvestor.com/2019/01/30/machine-learning-for-stock-market-investing/) [## 算法交易的机器学习|数据驱动的投资者

### 当你的一个朋友在脸书上传你的新海滩照，平台建议给你的脸加上标签，这是…

www.datadriveninvestor.com](https://www.datadriveninvestor.com/2019/01/30/machine-learning-for-stock-market-investing/) 

受到这些信息的启发——因为我喜欢利用市场的低效率——我利用免费的[tenquant . io](https://www.tenquant.io/)fundamentals API 和[羊驼的](https://alpaca.markets/)免佣金自动交易平台来寻找和交易这些想法。在本教程中，您将学习如何使用 [TenQuant.io](https://wwwTenQuant.io/) API 找到这些投资，并在羊驼上实现它们。

我们开始吧。

**完整代码:**

**设置**

安装羊驼交易 API:

```
pip3 install alpaca_trade_api
```

在我们进行真正的编码之前，我们需要确保我们拥有所有将要使用的依赖项。在 Python 程序的顶部导入它们:

```
import requestsimport jsonimport alpaca_trade_api as tradeapi
```

设置您的[羊驼账户](https://alpaca.markets/)并获取您的 API 密钥。在用真钱测试之前，我先从纸上交易账户开始，我建议你也这样做。

**API 集成**

将这些密钥输入到您的 Python 程序中(这是不安全的，您可能希望在生产程序中使用命令行参数或系统变量):

```
key = 'FAKE_KEY'secret = 'FAKE_SECRET'
```

建立与羊驼经纪公司的连接，并确保其正常工作:

```
base_url = 'https://paper-api.alpaca.markets'api = tradeapi.REST(key, secret, base_url, api_version='v2')account = api.get_account()print(account.status)
```

试一试你的程序吧！它应该打印出“活跃”，以表明您的帐户是活的。

接下来，我们需要搜索股票列表，找出那些高估或低估收益最多的股票。你需要从 [TenQuant.io](https://www.tenquant.io/) 获得一个免费的 API 密匙来访问基础数据。我们将使用/earningsreport API 端点来获取最新的可用财务数据。

设置 TenQuant API 连接:

```
tenquant_key = 'FAKE_KEY'
tenquant_base_url = 'https://api.tenquant.io'
```

**取股票数据**

添加要搜索的代码列表，或从文件中提取代码:

```
tickers_list = []
with open('tickers.txt', 'r+') as tickers_file:tickers_list = tickers_file.read().splitlines()
```

添加一个字典来保存收益数据——我们将让它按 ticker 索引:

```
stocks_data = {}
```

最后，让我们获得每只股票的一些关键数据:

```
for ticker in tickers_list:# build urlrequest_url = (tenquant_base_url + '/data?ticker={TICKER}&key={KEY}').replace('{TICKER}', ticker).replace('{KEY}', tenquant_key)# get json responseticker_json = requests.get(request_url).content# make sure everything works and make a Pytohn dict from the jsontry:ticker_data = dict(json.loads(ticker_json))except:continueif 'error' in ticker_data.keys():continue# extract key data pointsnet_income = ticker_data['netincomeloss']operating_income = ticker_data['operatingincomeloss']
```

**保存数据**

还是在这个循环中，让我们做一些数学计算，找出非营业利润对最新损益表的百分比影响:

```
non_operating_income = float(net_income) - float(operating_income)
    non_operating_income_percent = non_operating_income / abs(float(net_income))
```

使用股票代码作为关键字，将它添加到我们的字典中:

```
stocks_data[ticker] = non_operating_income_percent
```

这将使我们以后能够轻松地对数据进行排序。

**分析数据**

在最初的 for 循环之外，我们现在需要将它分成两个股票列表:对非营业收益产生最大负面影响的股票，以及对非营业收益产生最大正面影响的股票。

```
sorted_stocks_data = sorted(stocks_data.items(), key=lambda x: x[1])
```

现在，让我们找出最低调的 10%的公司收益:

```
understated_ten_percent = sorted_stocks_data[:int(len(sorted_stocks_data)/10) + 1]
```

而最被夸大的 10%:

```
overstated_ten_percent = sorted_stocks_data[-int(len(sorted_stocks_data)/10) - 1:]
```

让我们打印这些以确保程序正常工作:

```
print('Understated 10%: ')
print(understated_ten_percent)print('Overstated 10%: ')
print(overstated_ten_percent)
```

**该买了！**

最后，让我们做多收益被低估的股票，做空收益被高估的股票:

```
for long_stock, difference in understated_ten_percent:qty = 1side = 'buy'try:api.submit_order(stock, qty, side, "market", "day")print("Market order of | " + str(qty) + " " + stock + " " + side + " | completed.")except:print("Order of | " + str(qty) + " " + stock + " " + side + " | did not go through.")for short_stock, difference in overstated_ten_percent:qty = 1side = 'sell'try:api.submit_order(short_stock, qty, side, "market", "day")print("Market order of | " + str(qty) + " " + short_stock + " " + side + " | completed.")except:print("Order of | " + str(qty) + " " + short_stock + " " + side + " | did not go through.")
```

最后，检查你的羊驼仪表板，确保一切顺利——交易愉快！

你可以在我的 GitHub 这里找到完整的代码:[https://GitHub . com/HSA uers 5/AlpacaDemo/blob/master/alpaca . py](https://github.com/hsauers5/AlpacaDemo/blob/master/alpaca.py)

**改进这一战略的一些想法:**

*   添加技术指标
*   使用 TenQuant.io 中的其他端点来获得更详细的基本面情况。
*   将投资组合的权重改为等权，而不是各占一股。
*   计划每季度/每周/等运行此程序的功能。